<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>大转盘活动</title>
<link rel="stylesheet" type="text/css" href="css/reset.css"/>
<link rel="stylesheet" type="text/css" href="css/turntable.css"/>
<script type="text/javascript" src="js/jquery-3.1.1.min.js"></script>
<script type="text/javascript" src="js/awardRotate.js"></script>
<script type="text/javascript">
    function initScale(){
	    var iWidth=document.documentElement.getBoundingClientRect().width;
	    iWidth=iWidth>750?750:iWidth;
	    document.getElementsByTagName("html")[0].style.fontSize=iWidth/3.75+"px";
    }
    window.onresize=function(){
        initScale();
    }
    initScale();
</script>
<script type="text/javascript">
	
var turnplate={
		restaraunts:[],				//大转盘奖品名称
		startAngle:0,				//开始角度
		bRotate:false,				//false:停止;ture:旋转
		imgArr:['images/p3-bg.jpg',
		'images/p3-zhuanbg_03.png',
		'images/p3-jiangpin_03.png'
		]
};
$(document).ready(function(){
	
	//动态添加大转盘的奖品与奖品区域背景颜色
	turnplate.restaraunts = ["联想k歌宝", "优惠券", "联想看家宝", "小新玩偶", "小新air12","小新闪存盘"];
	turnplate.colors = ['#da000d'];
	var rotateTimeOut = function (){
		$('#wheelcanvas').rotate({
			angle:0,
			animateTo:2160,
			duration:5000,
			callback:function (){
				alert('网络超时，请检查您的网络设置！');
			}
		});
	};

	//旋转转盘 item:奖品位置; txt：提示语;
	var rotateFn = function (item, txt){
		var angles = item * (360 / turnplate.restaraunts.length) - (360 / (turnplate.restaraunts.length*2));
		if(angles<270){
			angles = 270 - angles; 
		}else{
			angles = 360 - angles + 270;
		}
		$('#wheelcanvas').stopRotate();
		$('#wheelcanvas').rotate({
			angle:0,
			animateTo:angles+1800,
			duration:5000,
			callback:function (){
				alert(txt);
				turnplate.bRotate = !turnplate.bRotate;
			}
		});
	};
	var a=0;
	
	$('.pointer').click(function (){
		a++;
		if(turnplate.bRotate)return;
		turnplate.bRotate = !turnplate.bRotate;
		//获取随机数(奖品个数范围内)
//		$.ajax({
//			type:'GET',
//			url:'',
//			
//		})
		var item = rnd(1,turnplate.restaraunts.length);
		//奖品数量等于10,指针落在对应奖品区域的中心角度[252, 216, 180, 144, 108, 72, 36, 360, 324, 288]
		rotateFn(item, turnplate.restaraunts[item-1]);       //奖品序号及弹出窗口内容
		if(a==parent.cjNumber){
			console.log('抽奖次数用完');
			$(this).unbind('click');
			$(this).on('click',function(){
				alert('抽奖次数用完')
			})
		}
	});
	
});

function rnd(n, m){
	var random = Math.floor(Math.random()*(m-n+1)+n);
	return random;
	
}
//页面所有元素加载完毕后执行drawRouletteWheel()方法对转盘进行渲染
window.onload=function(){
	drawRouletteWheel();
};

function drawRouletteWheel() {    
  var canvas = document.getElementById("wheelcanvas");    
  if (canvas.getContext) {
	  //根据奖品个数计算圆周角度
	  var ctx = canvas.getContext("2d");
	  var imgBg=document.getElementById('jiangpin');
		  ctx.drawImage(imgBg,6,6); 
  } 
}
</script>

</head>
<body style="position: relative;">
	<div class="model-topimg"></div>
	<div class="model-bottomimg"></div>
		<img src="images/p3-jiangpin_03.png" id="jiangpin" style="display:none;" />
		<div class=""></div>
		<div class="banner">
			<div class="turnplate" style="background-image: url(images/p3-zhuanbg_03.png);background-size:100% 100%;">
				<canvas class="item" id="wheelcanvas" width="422px" height="422px"></canvas>
				<img class="pointer" src="images/p3-chou_03.png" alt=""/>
			</div>
		</div>
	
	<!--<div class="lucky-name">
		<h2>中奖名单</h2>
		<div class="list-wrap">
			<ul class="name-list top">
				<li>132****1234</li>
				<li>132****1234</li>
				<li>132****1234</li>
				<li>132****1234</li>
				<li>132****1234</li>
			</ul>
			<ul class="name-list bottom">
				<li>132****1234</li>
				<li>132****1234</li>
				<li>132****1234</li>
				<li>132****1234</li>
				<li>132****1234</li>
			</ul>
		</div>
	</div>-->
	<!--<script type="text/javascript">
		window.requestAnimationFrame= window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
		var _top=0;
		requestAnimationFrame(newsList);
		function newsList(){
			for(var i=0;i<$("ul").length;i++){
				_top=parseInt($(".name-list").eq(i).css('top'));
				_top--;
				$(".name-list").eq(i).css('top',_top+'px')
				if(_top<-145){
					$(".name-list").eq(i).css('top','147px')
					var newList=$(".name-list").eq(i).clone();
					$(".list-wrap").append(newList);
					$(".name-list").eq(i).remove();
				}
			}
			if(true){
				requestAnimationFrame(newsList);
			}

		}
	</script>-->
</body>
</html>